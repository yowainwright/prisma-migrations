[["Map",1,2,9,10],"meta::meta",["Map",3,4,5,6,7,8],"astro-version","5.14.8","content-config-digest","262e19c900bdc416","astro-config-digest","{\"root\":{},\"srcDir\":{},\"publicDir\":{},\"outDir\":{},\"cacheDir\":{},\"site\":\"https://jeffry.in\",\"compressHTML\":true,\"base\":\"/prisma-migrations\",\"trailingSlash\":\"never\",\"output\":\"static\",\"scopedStyleStrategy\":\"attribute\",\"build\":{\"format\":\"directory\",\"client\":{},\"server\":{},\"assets\":\"_astro\",\"serverEntry\":\"entry.mjs\",\"redirects\":true,\"inlineStylesheets\":\"auto\",\"concurrency\":1},\"server\":{\"open\":false,\"host\":false,\"port\":4321,\"streaming\":true,\"allowedHosts\":[]},\"redirects\":{},\"image\":{\"endpoint\":{\"route\":\"/_image\"},\"service\":{\"entrypoint\":\"astro/assets/services/sharp\",\"config\":{}},\"domains\":[],\"remotePatterns\":[],\"responsiveStyles\":false},\"devToolbar\":{\"enabled\":true},\"markdown\":{\"syntaxHighlight\":{\"type\":\"shiki\",\"excludeLangs\":[\"math\"]},\"shikiConfig\":{\"langs\":[],\"langAlias\":{},\"theme\":{\"name\":\"yves-klein-blue\",\"type\":\"dark\",\"colors\":{\"editor.background\":\"#031030\",\"editor.foreground\":\"#A8E6FF\"},\"tokenColors\":[{\"scope\":[\"comment\",\"punctuation.definition.comment\"],\"settings\":{\"foreground\":\"#8DC891\",\"fontStyle\":\"italic\"}},{\"scope\":[\"keyword\",\"storage.type\",\"storage.modifier\"],\"settings\":{\"foreground\":\"#82CFFF\"}},{\"scope\":[\"string\",\"string.quoted\"],\"settings\":{\"foreground\":\"#FFF4B3\"}},{\"scope\":[\"entity.name.function\",\"support.function\"],\"settings\":{\"foreground\":\"#FF8BA7\"}},{\"scope\":[\"variable\",\"variable.parameter\"],\"settings\":{\"foreground\":\"#82CFFF\"}},{\"scope\":[\"constant.numeric\",\"constant.language\"],\"settings\":{\"foreground\":\"#C9E5B4\"}},{\"scope\":[\"entity.name.type\",\"entity.name.class\",\"support.type\",\"support.class\"],\"settings\":{\"foreground\":\"#FF8BA7\"}},{\"scope\":[\"keyword.operator\"],\"settings\":{\"foreground\":\"#FFB3D9\"}},{\"scope\":[\"punctuation\"],\"settings\":{\"foreground\":\"#FFE55C\"}}]},\"themes\":{},\"wrap\":false,\"transformers\":[]},\"remarkPlugins\":[],\"rehypePlugins\":[],\"remarkRehype\":{},\"gfm\":true,\"smartypants\":true},\"security\":{\"checkOrigin\":true,\"allowedDomains\":[]},\"env\":{\"schema\":{},\"validateSecrets\":false},\"experimental\":{\"clientPrerender\":false,\"contentIntellisense\":false,\"headingIdCompat\":false,\"preserveScriptOrder\":false,\"liveContentCollections\":false,\"csp\":false,\"staticImportMetaEnv\":false,\"chromeDevtoolsWorkspace\":false,\"failOnPrerenderConflict\":false},\"legacy\":{\"collections\":false}}","docs",["Map",11,12,21,22,30,31,39,40,48,49,57,58],"api-reference",{"id":11,"data":13,"body":16,"filePath":17,"digest":18,"legacyId":19,"deferredRender":20},{"title":14,"description":15},"API Reference","Complete reference for Prisma Migrations CLI and Node.js API","Prisma Migrations provides both a CLI interface and a programmatic Node.js API.\n\n## CLI Commands\n\nAll CLI commands use the following format:\n\n```bash\nnpx prisma-migrations \u003Ccommand> [options]\n```\n\n### `init`\n\nInitialize migrations directory with first migration file.\n\n```bash\nnpx prisma-migrations init\n```\n\n**Output:**\n```bash\n✓ Created migration: 1234567890_initial_migration\n  Location: ./prisma/migrations/1234567890_initial_migration\n```\n\n---\n\n### `create [name]`\n\nCreate a new migration file with optional name.\n\n```bash\nnpx prisma-migrations create add_users_table\n```\n\n**Arguments:**\n- `name` (optional) - Migration name (kebab-case recommended)\n\n**Output:**\n```bash\n✓ Created migration: 1234567890_add_users_table\n  Location: ./prisma/migrations/1234567890_add_users_table\n```\n\n---\n\n### `up [options]`\n\nRun pending migrations.\n\n```bash\n# Run all pending migrations\nnpx prisma-migrations up\n\n# Run next 3 migrations\nnpx prisma-migrations up --steps 3\n\n# Interactive mode - choose which migrations to run\nnpx prisma-migrations up --interactive\n```\n\n**Options:**\n- `--steps \u003Cnumber>` - Number of migrations to run\n- `--interactive` or `-i` - Interactive selection mode\n\n**Output:**\n```bash\n┌──────────┬──────────────────────────────────────────────────┐\n│ Status   │ Migrations                                       │\n├──────────┼──────────────────────────────────────────────────┤\n│ ✓        │ 2 migration(s) applied successfully              │\n└──────────┴──────────────────────────────────────────────────┘\n```\n\n---\n\n### `down [options]`\n\nRollback migrations.\n\n```bash\n# Rollback last migration\nnpx prisma-migrations down\n\n# Rollback last 2 migrations\nnpx prisma-migrations down --steps 2\n\n# Interactive mode - choose which migrations to rollback\nnpx prisma-migrations down --interactive\n```\n\n**Options:**\n- `--steps \u003Cnumber>` - Number of migrations to rollback (default: 1)\n- `--interactive` or `-i` - Interactive selection mode\n\n**Output:**\n```bash\n┌──────────┬──────────────────────────────────────────────────┐\n│ Status   │ Migrations                                       │\n├──────────┼──────────────────────────────────────────────────┤\n│ ↓        │ 1 migration(s) rolled back                       │\n└──────────┴──────────────────────────────────────────────────┘\n```\n\n---\n\n### `status`\n\nShow migration status (which migrations are applied/pending).\n\n```bash\nnpx prisma-migrations status\n```\n\n---\n\n### `pending`\n\nList all pending (not yet applied) migrations.\n\n```bash\nnpx prisma-migrations pending\n```\n\n**Output:**\n```bash\n3 pending migration(s):\n\n  1234567890_add_users_table\n  1234567891_add_posts_table\n  1234567892_add_comments_table\n```\n\n---\n\n### `applied`\n\nList all applied migrations.\n\n```bash\nnpx prisma-migrations applied\n```\n\n**Output:**\n```bash\n2 applied migration(s):\n\n  ✓ 1234567889_initial_migration\n  ✓ 1234567890_add_users_table\n```\n\n---\n\n### `latest`\n\nShow the latest applied migration.\n\n```bash\nnpx prisma-migrations latest\n```\n\n---\n\n### `reset`\n\nRollback all migrations.\n\n```bash\nnpx prisma-migrations reset\n```\n\n---\n\n### `fresh`\n\nRollback all migrations and re-run them (fresh start).\n\n```bash\nnpx prisma-migrations fresh\n```\n\n---\n\n### `refresh`\n\nAlias for `fresh` command.\n\n```bash\nnpx prisma-migrations refresh\n```\n\n---\n\n### `mcp`\n\nStart the MCP (Model Context Protocol) server for AI assistant integration.\n\n```bash\nnpx prisma-migrations mcp\n```\n\n**Description:**\nProvides 15 tools for AI assistants to manage both data migrations and Prisma operations:\n- **Data migrations**: status, pending, applied, up, down, create, dry-run, reset, fresh, refresh\n- **Prisma operations**: migrate dev/deploy/resolve, db push, generate\n\nUse with Claude Desktop or other MCP-compatible AI assistants for AI-assisted database management.\n\n---\n\n### Global Options\n\nThese options work with any command:\n\n- `--verbose` or `-v` - Enable verbose logging\n- `--log-level \u003Clevel>` - Set log level (silent, error, warn, info, debug, trace)\n\n**Example:**\n```bash\nnpx prisma-migrations up --verbose\nnpx prisma-migrations --log-level debug up\n```\n\n## Programmatic API\n\nUse the migrations system from your Node.js/TypeScript code.\n\n### Import\n\n```typescript\nimport { Migrations } from 'prisma-migrations';\nimport { PrismaClient } from '@prisma/client';\n```\n\n### Constructor\n\n```typescript\nnew Migrations(prisma: PrismaClient, config?: MigrationsConfig)\n```\n\n**Parameters:**\n\n| Parameter | Type | Required | Description |\n|-----------|------|----------|-------------|\n| `prisma` | `PrismaClient` | Yes | Your Prisma Client instance |\n| `config` | `MigrationsConfig` | No | Optional configuration |\n\n**Config Options:**\n\n```typescript\ninterface MigrationsConfig {\n  migrationsDir?: string;  // Default: auto-discovered from ./prisma/migrations\n  logLevel?: 'silent' | 'error' | 'warn' | 'info' | 'debug' | 'trace';\n}\n```\n\n**Example:**\n\n```typescript\nconst prisma = new PrismaClient();\nconst migrations = new Migrations(prisma, {\n  migrationsDir: './database/migrations',\n  logLevel: 'info'\n});\n```\n\n---\n\n### Methods\n\n#### `up(steps?: number): Promise\u003Cnumber>`\n\nRun pending migrations.\n\n**Parameters:**\n- `steps` (optional) - Number of migrations to run. If omitted, runs all pending migrations.\n\n**Returns:**\n- `Promise\u003Cnumber>` - Number of migrations applied\n\n**Example:**\n\n```typescript\n// Run all pending migrations\nconst count = await migrations.up();\nconsole.log(`Applied ${count} migrations`);\n\n// Run next 3 migrations\nawait migrations.up(3);\n```\n\n---\n\n#### `down(steps?: number): Promise\u003Cnumber>`\n\nRollback migrations.\n\n**Parameters:**\n- `steps` (optional) - Number of migrations to rollback (default: 1)\n\n**Returns:**\n- `Promise\u003Cnumber>` - Number of migrations rolled back\n\n**Example:**\n\n```typescript\n// Rollback last migration\nawait migrations.down();\n\n// Rollback last 3 migrations\nawait migrations.down(3);\n```\n\n---\n\n#### `pending(): Promise\u003CMigrationFile[]>`\n\nGet list of pending migrations.\n\n**Returns:**\n- `Promise\u003CMigrationFile[]>` - Array of pending migration objects\n\n**MigrationFile Interface:**\n\n```typescript\ninterface MigrationFile {\n  id: string;      // Migration ID (timestamp)\n  name: string;    // Migration name\n  path: string;    // Full path to migration file\n  fileType: 'ts' | 'sql';  // Migration file type\n}\n```\n\n**Example:**\n\n```typescript\nconst pending = await migrations.pending();\nconsole.log(`${pending.length} pending migrations:`);\npending.forEach(m => console.log(`  ${m.id}_${m.name}`));\n```\n\n---\n\n#### `applied(): Promise\u003CMigrationFile[]>`\n\nGet list of applied migrations.\n\n**Returns:**\n- `Promise\u003CMigrationFile[]>` - Array of applied migration objects\n\n**Example:**\n\n```typescript\nconst applied = await migrations.applied();\nconsole.log(`${applied.length} applied migrations`);\n```\n\n---\n\n#### `latest(): Promise\u003CMigrationFile | null>`\n\nGet the latest applied migration.\n\n**Returns:**\n- `Promise\u003CMigrationFile | null>` - Latest migration or null if none applied\n\n**Example:**\n\n```typescript\nconst latest = await migrations.latest();\nif (latest) {\n  console.log(`Latest: ${latest.id}_${latest.name}`);\n}\n```\n\n---\n\n#### `status(): Promise\u003Cvoid>`\n\nDisplay migration status (logs to console).\n\n**Example:**\n\n```typescript\nawait migrations.status();\n```\n\n---\n\n#### `reset(): Promise\u003Cnumber>`\n\nRollback all migrations.\n\n**Returns:**\n- `Promise\u003Cnumber>` - Number of migrations rolled back\n\n**Example:**\n\n```typescript\nconst count = await migrations.reset();\nconsole.log(`Rolled back ${count} migrations`);\n```\n\n---\n\n#### `fresh(): Promise\u003Cnumber>`\n\nRollback all migrations and re-run them.\n\n**Returns:**\n- `Promise\u003Cnumber>` - Number of migrations applied after reset\n\n**Example:**\n\n```typescript\nawait migrations.fresh();\n```\n\n---\n\n#### `refresh(): Promise\u003C{ down: number; up: number }>`\n\nAlias for `fresh()` but returns detailed counts.\n\n**Returns:**\n- `Promise\u003C{ down: number; up: number }>` - Number of migrations rolled back and reapplied\n\n**Example:**\n\n```typescript\nconst result = await migrations.refresh();\nconsole.log(`Rolled back ${result.down}, applied ${result.up}`);\n```\n\n## Complete Example\n\n```typescript\nimport { Migrations } from 'prisma-migrations';\nimport { PrismaClient } from '@prisma/client';\n\nasync function runMigrations() {\n  const prisma = new PrismaClient();\n  const migrations = new Migrations(prisma);\n\n  try {\n    // Check pending migrations\n    const pending = await migrations.pending();\n    console.log(`Found ${pending.length} pending migrations`);\n\n    // Run migrations\n    const applied = await migrations.up();\n    console.log(`Successfully applied ${applied} migrations`);\n\n    // Verify latest migration\n    const latest = await migrations.latest();\n    if (latest) {\n      console.log(`Latest migration: ${latest.name}`);\n    }\n  } catch (error) {\n    console.error('Migration failed:', error);\n    process.exit(1);\n  } finally {\n    await prisma.$disconnect();\n  }\n}\n\nrunMigrations();\n```\n\n## Usage Examples\n\n### Application Startup\n\nRun migrations when your app starts:\n\n```typescript\nimport { Migrations } from 'prisma-migrations';\nimport { PrismaClient } from '@prisma/client';\n\nconst prisma = new PrismaClient();\n\nasync function bootstrap() {\n  const migrations = new Migrations(prisma);\n\n  // Run pending migrations on startup\n  const count = await migrations.up();\n  console.log(`Applied ${count} migrations`);\n\n  // Start your application\n  await startServer();\n}\n\nbootstrap();\n```\n\n### CI/CD Deployment\n\nRun migrations during deployment:\n\n```typescript\nimport { Migrations } from 'prisma-migrations';\nimport { PrismaClient } from '@prisma/client';\n\nasync function deploy() {\n  const prisma = new PrismaClient();\n  const migrations = new Migrations(prisma);\n\n  try {\n    // Check for pending migrations\n    const pending = await migrations.pending();\n\n    if (pending.length === 0) {\n      console.log('No migrations to run');\n      return;\n    }\n\n    console.log(`Running ${pending.length} migrations...`);\n    await migrations.up();\n    console.log('✓ Migrations completed successfully');\n  } catch (error) {\n    console.error('✗ Migration failed:', error);\n    process.exit(1);\n  } finally {\n    await prisma.$disconnect();\n  }\n}\n\ndeploy();\n```\n\n### Safe Rollback\n\nRollback with error handling:\n\n```typescript\nimport { Migrations } from 'prisma-migrations';\nimport { PrismaClient } from '@prisma/client';\n\nasync function rollbackLastMigration() {\n  const prisma = new PrismaClient();\n  const migrations = new Migrations(prisma);\n\n  try {\n    const latest = await migrations.latest();\n    if (!latest) {\n      console.log('No migrations to rollback');\n      return;\n    }\n\n    console.log(`Rolling back: ${latest.name}`);\n    await migrations.down();\n    console.log('✓ Rollback successful');\n  } catch (error) {\n    console.error('✗ Rollback failed:', error);\n    process.exit(1);\n  } finally {\n    await prisma.$disconnect();\n  }\n}\n\nrollbackLastMigration();\n```\n\n### Development Reset\n\nFresh start for development:\n\n```typescript\nimport { Migrations } from 'prisma-migrations';\nimport { PrismaClient } from '@prisma/client';\n\nasync function resetDatabase() {\n  const prisma = new PrismaClient();\n  const migrations = new Migrations(prisma);\n\n  console.log('Resetting database...');\n\n  // Rollback all migrations\n  const rolled = await migrations.reset();\n  console.log(`Rolled back ${rolled} migrations`);\n\n  // Re-run all migrations\n  const applied = await migrations.up();\n  console.log(`Applied ${applied} migrations`);\n\n  console.log('✓ Database reset complete');\n\n  await prisma.$disconnect();\n}\n\nresetDatabase();\n```\n\n## TypeScript\n\nPrisma Migrations includes full TypeScript support with type safety:\n\n```typescript\nimport type {\n  PrismaClient,\n  MigrationFile,\n  MigrationFunction,\n  MigrationsConfig\n} from 'prisma-migrations';\n\n// Type-safe migration functions\nexport async function up(prisma: PrismaClient): Promise\u003Cvoid> {\n  await prisma.$executeRaw`CREATE TABLE users (id SERIAL PRIMARY KEY)`;\n}\n\nexport async function down(prisma: PrismaClient): Promise\u003Cvoid> {\n  await prisma.$executeRaw`DROP TABLE IF EXISTS users`;\n}\n\n// Type-safe configuration\nconst config: MigrationsConfig = {\n  migrationsDir: './database/migrations',\n  logLevel: 'info'\n};\n```","src/content/docs/api-reference.mdx","e317e88b7f8e8a9d","api-reference.mdx",true,"introduction",{"id":21,"data":23,"body":26,"filePath":27,"digest":28,"legacyId":29,"deferredRender":20},{"title":24,"description":25},"Introduction to Prisma Migrations","Add rollback and programmatic control to Prisma migrations","\u003Cdiv className=\"flex flex-wrap gap-2 mb-8\">\n  \u003Ca href=\"https://badge.fury.io/js/prisma-migrations\" target=\"_blank\" rel=\"noopener noreferrer\">\n    \u003Cimg src=\"https://badge.fury.io/js/prisma-migrations.svg\" alt=\"npm version\" />\n  \u003C/a>\n  \u003Ca href=\"https://www.typescriptlang.org/\" target=\"_blank\" rel=\"noopener noreferrer\">\n    \u003Cimg src=\"https://img.shields.io/badge/TypeScript-Ready-blue\" alt=\"TypeScript Ready\" />\n  \u003C/a>\n  \u003Ca href=\"https://opensource.org/licenses/MIT\" target=\"_blank\" rel=\"noopener noreferrer\">\n    \u003Cimg src=\"https://img.shields.io/badge/License-MIT-yellow.svg\" alt=\"License: MIT\" />\n  \u003C/a>\n  \u003Ca href=\"https://github.com/yowainwright/prisma-migrations\" target=\"_blank\" rel=\"noopener noreferrer\">\n    \u003Cimg src=\"https://img.shields.io/github/stars/yowainwright/prisma-migrations?style=social\" alt=\"GitHub stars\" />\n  \u003C/a>\n\u003C/div>\n\n## What is Prisma Migrations?\n\nIf you're using Prisma but miss having rollback and programmatic migration control like other ORMs, this tool fills those gaps. It wraps Prisma's migration system and adds the features that should have been there from the start.\n\n## The Problem\n\nPrisma's `prisma migrate` works well for forward migrations, but has some limitations:\n\n- **No rollback** - Once a migration is applied, there's no built-in way to undo it\n- **No programmatic API** - You can't run migrations from your Node.js code\n- **Limited control** - Can't run specific numbers of migrations or choose which to apply\n\nMeanwhile, pretty much every other ORM (Knex, TypeORM, Sequelize, Rails, Laravel) has had these features for years.\n\nWhen you hit these limitations in production, you're stuck manually writing SQL or working around Prisma's constraints.\n\n## The Solution\n\nThis tool wraps Prisma and adds what's missing:\n\n| Feature | Prisma Migrate | prisma-migrations |\n|---------|---------------|-------------------|\n| Run migrations forward | ✓ | ✓ |\n| Deploy to production | ✓ | ✓ |\n| Rollback migrations | ✗ | ✓ |\n| Run from Node.js code | ✗ | ✓ |\n| Step-by-step control | ✗ | ✓ |\n| Interactive mode | ✗ | ✓ |\n| Up/down migrations | ✗ | ✓ |\n\n**Key point:** This is 100% compatible with Prisma. It uses Prisma's standard `_prisma_migrations` table and works alongside `prisma migrate` commands.\n\n## Quick Example\n\n### CLI Usage\n\n```bash\n# Create a migration\nnpx prisma-migrations create add_users\n\n# Run migrations\nnpx prisma-migrations up\n\n# Rollback when needed\nnpx prisma-migrations down\n```\n\n### Migration File\n\n```sql\n-- Migration: Up\nCREATE TABLE users (\n  id SERIAL PRIMARY KEY,\n  email VARCHAR(255) UNIQUE NOT NULL,\n  created_at TIMESTAMP DEFAULT NOW()\n);\n\n-- Migration: Down\nDROP TABLE IF EXISTS users;\n```\n\n### Programmatic API\n\n```typescript\nimport { Migrations } from 'prisma-migrations';\nimport { PrismaClient } from '@prisma/client';\n\nconst prisma = new PrismaClient();\nconst migrations = new Migrations(prisma);\n\n// Run all pending migrations\nawait migrations.up();\n\n// Rollback last migration\nawait migrations.down();\n```\n\n## Key Features\n\n- **Rollback support** - Up and down migrations like other ORMs\n- **Programmatic API** - Run migrations from your Node.js/TypeScript code\n- **Step control** - Run or rollback N migrations at a time\n- **Interactive mode** - Choose which migrations to apply\n- **SQL migrations** - Standard SQL format with up/down sections\n- **Zero config** - Works out of the box with existing Prisma projects\n- **Prisma compatible** - Uses Prisma's `_prisma_migrations` table\n\n## When to Use This\n\n**Use this tool if:**\n- You need to rollback migrations (especially in production)\n- You want to run migrations programmatically\n- You want step-by-step control over migrations\n- You're coming from Knex/TypeORM/etc and miss those features\n\n**Use Prisma Migrate if:**\n- You only ever need forward migrations\n- CLI-only execution is fine for you\n- You don't need rollback\n\nBoth can coexist - they use the same migration table.\n\n## Next Steps\n\n- [Installation & Quick Start](/docs/setup) - Get started in 5 minutes\n- [Code Labs](/docs/codelab-new-project) - Step-by-step tutorials\n- [API Reference](/docs/api-reference) - Full documentation","src/content/docs/introduction.mdx","01ca975c7a379e20","introduction.mdx","setup",{"id":30,"data":32,"body":35,"filePath":36,"digest":37,"legacyId":38,"deferredRender":20},{"title":33,"description":34},"Installation & Quick Start","Get started with Prisma Migrations in minutes","\u003Csection>\n\n## Installation\n\nInstall Prisma Migrations in your project:\n\n```bash\nnpm install prisma-migrations\n```\n\n## Quick Start\n\n### 1. Initialize Your Migrations\n\nCreate your first migration file:\n\n```bash\nnpx prisma-migrations init\n```\n\nThis creates a migration directory structure:\n\n```bash\nprisma/migrations/\n└── [timestamp]_initial_migration/\n    └── migration.ts\n```\n\n### 2. Create a Migration\n\nGenerate a new migration file:\n\n```bash\nnpx prisma-migrations create add_users_table\n```\n\nThis creates:\n\n```bash\nprisma/migrations/\n└── [timestamp]_add_users_table/\n    └── migration.ts\n```\n\n### 3. Write Your Migration\n\nEdit the generated migration file with TypeScript:\n\n```typescript\n// prisma/migrations/[timestamp]_add_users_table/migration.ts\nimport type { PrismaClient } from 'prisma-migrations';\n\nexport async function up(prisma: PrismaClient) {\n  await prisma.$executeRaw`\n    CREATE TABLE users (\n      id SERIAL PRIMARY KEY,\n      email VARCHAR(255) UNIQUE NOT NULL,\n      name VARCHAR(255),\n      created_at TIMESTAMP DEFAULT NOW()\n    )\n  `;\n}\n\nexport async function down(prisma: PrismaClient) {\n  await prisma.$executeRaw`DROP TABLE IF EXISTS users`;\n}\n```\n\n### 4. Run Migrations\n\nApply all pending migrations:\n\n```bash\nnpx prisma-migrations up\n```\n\n### 5. Rollback (When Needed)\n\nUndo the last migration:\n\n```bash\nnpx prisma-migrations down\n```\n\nRoll back multiple migrations:\n\n```bash\nnpx prisma-migrations down --steps 3\n```\n\n## Using with Existing Prisma Projects\n\nPrisma Migrations works seamlessly with existing Prisma projects! It uses the same `_prisma_migrations` table that Prisma's native migrations use.\n\n### If You Already Have Migrations\n\nYou can add Prisma Migrations to an existing project:\n\n1. Install the package\n2. Run `npx prisma-migrations status` to see existing migrations\n3. Create new migrations with `npx prisma-migrations create`\n4. Your new migrations will work alongside existing Prisma migrations\n\n### Compatibility\n\n- Uses Prisma's standard `_prisma_migrations` table\n- Works with `prisma migrate` commands\n- No conflicts with existing migration workflows\n- Fully compatible with Prisma Client\n\n## Next Steps\n\n- Learn about [CLI commands](/prisma-migrations/docs/api-reference) for migration management\n- Explore [programmatic API](/prisma-migrations/docs/api-reference#programmatic-api) for running migrations from code\n- See [advanced features](/prisma-migrations/docs/advanced-features) like interactive mode and step control\n- Check [troubleshooting](/prisma-migrations/docs/troubleshooting) for common issues\n\n---\n\n\u003C/section>","src/content/docs/setup.mdx","7ebac9ac60a16526","setup.mdx","workspaces",{"id":39,"data":41,"body":44,"filePath":45,"digest":46,"legacyId":47,"deferredRender":20},{"title":42,"description":43},"Writing Migrations","Learn how to write effective database migrations with Prisma Migrations","This guide covers how to write migrations using SQL with up/down sections.\n\n## Migration File Structure\n\nEach migration is stored in its own directory with a `migration.sql` file:\n\n```bash\nprisma/migrations/\n└── [timestamp]_migration_name/\n    └── migration.sql\n```\n\nThe timestamp format is the same as Prisma's default: `20240101000000_migration_name`\n\n## Basic Migration Format\n\nEach SQL file contains two sections separated by marker comments:\n\n```sql\n-- Migration: Up\n-- This section runs when you do: npx prisma-migrations up\nCREATE TABLE users (\n  id SERIAL PRIMARY KEY,\n  email VARCHAR(255) UNIQUE NOT NULL,\n  created_at TIMESTAMP DEFAULT NOW()\n);\n\n-- Migration: Down\n-- This section runs when you do: npx prisma-migrations down\nDROP TABLE IF EXISTS users;\n```\n\n**Important:** The marker comments must be exactly:\n- `-- Migration: Up`\n- `-- Migration: Down`\n\n## Common Migration Patterns\n\n### Creating Tables\n\n```sql\n-- Migration: Up\nCREATE TABLE posts (\n  id SERIAL PRIMARY KEY,\n  title VARCHAR(255) NOT NULL,\n  content TEXT,\n  author_id INTEGER REFERENCES users(id),\n  published BOOLEAN DEFAULT false,\n  created_at TIMESTAMP DEFAULT NOW(),\n  updated_at TIMESTAMP DEFAULT NOW()\n);\n\nCREATE INDEX idx_posts_author_id ON posts(author_id);\nCREATE INDEX idx_posts_published ON posts(published);\n\n-- Migration: Down\nDROP TABLE IF EXISTS posts;\n```\n\n### Adding Columns\n\n```sql\n-- Migration: Up\nALTER TABLE users ADD COLUMN last_login TIMESTAMP;\nALTER TABLE users ADD COLUMN is_active BOOLEAN DEFAULT true;\n\n-- Migration: Down\nALTER TABLE users DROP COLUMN last_login;\nALTER TABLE users DROP COLUMN is_active;\n```\n\n### Modifying Columns\n\n```sql\n-- Migration: Up\nALTER TABLE users ALTER COLUMN email TYPE TEXT;\nALTER TABLE users ALTER COLUMN name SET NOT NULL;\nALTER TABLE users ALTER COLUMN role SET DEFAULT 'member';\n\n-- Migration: Down\nALTER TABLE users ALTER COLUMN email TYPE VARCHAR(255);\nALTER TABLE users ALTER COLUMN name DROP NOT NULL;\nALTER TABLE users ALTER COLUMN role DROP DEFAULT;\n```\n\n### Data Migrations\n\n```sql\n-- Migration: Up\nINSERT INTO roles (name, permissions) VALUES\n  ('admin', '{\"all\": true}'),\n  ('user', '{\"read\": true}'),\n  ('guest', '{\"read\": true, \"write\": false}');\n\n-- Migration: Down\nDELETE FROM roles WHERE name IN ('admin', 'user', 'guest');\n```\n\n### Creating Indexes\n\n```sql\n-- Migration: Up\nCREATE INDEX idx_users_email ON users(email);\nCREATE INDEX idx_users_created_at ON users(created_at);\nCREATE UNIQUE INDEX idx_users_username ON users(username);\n\n-- Migration: Down\nDROP INDEX IF EXISTS idx_users_email;\nDROP INDEX IF EXISTS idx_users_created_at;\nDROP INDEX IF EXISTS idx_users_username;\n```\n\n### Renaming Columns\n\n```sql\n-- Migration: Up\nALTER TABLE users RENAME COLUMN old_email TO email;\n\n-- Migration: Down\nALTER TABLE users RENAME COLUMN email TO old_email;\n```\n\n## Best Practices\n\n### 1. Always Write Down Migrations\n\nEvery `Up` section should have a corresponding `Down` that reverses it:\n\n```sql\n-- ✓ Good\n-- Migration: Up\nCREATE TABLE foo (id SERIAL PRIMARY KEY);\n\n-- Migration: Down\nDROP TABLE IF EXISTS foo;\n```\n\n```sql\n-- ✗ Bad - Empty down section\n-- Migration: Up\nCREATE TABLE foo (id SERIAL PRIMARY KEY);\n\n-- Migration: Down\n-- Nothing here!\n```\n\n### 2. Use Descriptive Migration Names\n\n```bash\n# ✓ Good\nnpx prisma-migrations create add_user_email_verification\nnpx prisma-migrations create add_posts_published_at_column\n\n# ✗ Bad\nnpx prisma-migrations create update\nnpx prisma-migrations create changes\n```\n\n### 3. Keep Migrations Focused\n\nEach migration should do one logical thing:\n\n```bash\n# ✓ Good - Separate migrations\nnpx prisma-migrations create add_users_table\nnpx prisma-migrations create add_posts_table\nnpx prisma-migrations create add_users_last_login\n\n# ✗ Bad - Too much in one migration\nnpx prisma-migrations create add_all_tables_and_columns\n```\n\n### 4. Test Both Directions\n\nAlways test both up and down:\n\n```bash\n# Test up\nnpx prisma-migrations up\n\n# Verify changes\npsql -d mydb -c \"\\d users\"\n\n# Test down\nnpx prisma-migrations down\n\n# Verify rollback worked\npsql -d mydb -c \"\\d users\"\n\n# Test up again\nnpx prisma-migrations up\n```\n\n### 5. Use IF EXISTS/IF NOT EXISTS\n\nMake migrations more resilient:\n\n```sql\n-- Migration: Up\nCREATE TABLE IF NOT EXISTS users (\n  id SERIAL PRIMARY KEY\n);\n\n-- Migration: Down\nDROP TABLE IF EXISTS users;\n```\n\n## Multi-Step Data Migrations\n\nWhen you need to transform data, break it into steps:\n\n```sql\n-- Migration: Up\n-- Step 1: Add new column\nALTER TABLE users ADD COLUMN full_name VARCHAR(255);\n\n-- Step 2: Populate from existing data\nUPDATE users SET full_name = first_name || ' ' || last_name;\n\n-- Step 3: Make it required\nALTER TABLE users ALTER COLUMN full_name SET NOT NULL;\n\n-- Step 4: Drop old columns\nALTER TABLE users DROP COLUMN first_name;\nALTER TABLE users DROP COLUMN last_name;\n\n-- Migration: Down\n-- Reverse all steps\nALTER TABLE users ADD COLUMN first_name VARCHAR(255);\nALTER TABLE users ADD COLUMN last_name VARCHAR(255);\n\nUPDATE users\nSET first_name = split_part(full_name, ' ', 1),\n    last_name = split_part(full_name, ' ', 2);\n\nALTER TABLE users DROP COLUMN full_name;\n```\n\n## Database-Specific Features\n\n### PostgreSQL\n\n**JSON columns:**\n```sql\n-- Migration: Up\nALTER TABLE users ADD COLUMN metadata JSONB DEFAULT '{}';\nCREATE INDEX idx_users_metadata ON users USING GIN(metadata);\n\n-- Migration: Down\nDROP INDEX IF EXISTS idx_users_metadata;\nALTER TABLE users DROP COLUMN metadata;\n```\n\n**Arrays:**\n```sql\n-- Migration: Up\nALTER TABLE users ADD COLUMN tags TEXT[] DEFAULT ARRAY[]::TEXT[];\n\n-- Migration: Down\nALTER TABLE users DROP COLUMN tags;\n```\n\n**Full-text search:**\n```sql\n-- Migration: Up\nALTER TABLE posts ADD COLUMN search_vector TSVECTOR;\nCREATE INDEX idx_posts_search ON posts USING GIN(search_vector);\n\nUPDATE posts SET search_vector = to_tsvector('english', title || ' ' || content);\n\n-- Migration: Down\nDROP INDEX IF EXISTS idx_posts_search;\nALTER TABLE posts DROP COLUMN search_vector;\n```\n\n### MySQL\n\n**JSON columns:**\n```sql\n-- Migration: Up\nALTER TABLE users ADD COLUMN metadata JSON;\n\n-- Migration: Down\nALTER TABLE users DROP COLUMN metadata;\n```\n\n**Fulltext indexes:**\n```sql\n-- Migration: Up\nALTER TABLE posts ADD FULLTEXT INDEX idx_posts_content (content);\n\n-- Migration: Down\nDROP INDEX idx_posts_content ON posts;\n```\n\n### SQLite\n\n**Adding columns (SQLite limitations):**\n```sql\n-- Migration: Up\nALTER TABLE users ADD COLUMN email TEXT;\n\n-- Migration: Down\n-- Note: SQLite doesn't support DROP COLUMN easily\n-- You'd need to recreate the table without the column\nCREATE TABLE users_backup AS SELECT id, name FROM users;\nDROP TABLE users;\nALTER TABLE users_backup RENAME TO users;\n```\n\n## Handling Schema and Data Together\n\nSometimes you need to mix schema changes with data migrations:\n\n```sql\n-- Migration: Up\n-- 1. Add new column (nullable first)\nALTER TABLE users ADD COLUMN status VARCHAR(50);\n\n-- 2. Set default for existing rows\nUPDATE users SET status = 'active' WHERE is_active = true;\nUPDATE users SET status = 'inactive' WHERE is_active = false;\n\n-- 3. Make it required\nALTER TABLE users ALTER COLUMN status SET NOT NULL;\n\n-- 4. Drop old column\nALTER TABLE users DROP COLUMN is_active;\n\n-- Migration: Down\nALTER TABLE users ADD COLUMN is_active BOOLEAN;\nUPDATE users SET is_active = (status = 'active');\nALTER TABLE users DROP COLUMN status;\n```\n\n## Troubleshooting\n\n### Migration Failed Mid-Way\n\nIf a migration fails partway through:\n\n1. Check your database state manually\n2. Fix the SQL in the migration file\n3. Either:\n   - Clean up partial changes manually and re-run\n   - Write a new migration to continue from current state\n\n### Testing Rollbacks\n\nAlways test your down migrations in a staging environment first:\n\n```bash\n# In staging\nnpx prisma-migrations up\n# Test the app\nnpx prisma-migrations down\n# Verify rollback worked\nnpx prisma-migrations up\n# Test again\n```\n\n### Syntax Errors\n\nIf you get SQL syntax errors:\n- Check your SQL syntax for your specific database (PostgreSQL, MySQL, SQLite)\n- Test the SQL directly in your database client first\n- Make sure marker comments are exact: `-- Migration: Up` and `-- Migration: Down`\n\n### Reversing Complex Migrations\n\nSome operations are hard to reverse:\n- Dropping columns (data loss)\n- Complex data transformations\n\nFor these, consider:\n- Backing up data before dropping\n- Documenting manual steps in comments\n- Testing extensively in staging\n\n## Next Steps\n\n- [Installation & Setup](/docs/setup) - Get started with Prisma Migrations\n- [CLI Commands](/docs/api-reference#cli-commands) - Learn all available commands\n- [Code Labs](/docs/codelab-new-project) - Step-by-step tutorials","src/content/docs/workspaces.mdx","ead81f5c52f3c6a8","workspaces.mdx","codelab-migrate",{"id":48,"data":50,"body":53,"filePath":54,"digest":55,"legacyId":56,"deferredRender":20},{"title":51,"description":52},"Code Lab: Migrate from Prisma Migrate","Step-by-step guide to migrating an existing Prisma project to prisma-migrations for rollback support","# Code Lab: Migrating from Prisma Migrate to Prisma Migrations\n\nThis code lab shows you how to migrate an existing project using Prisma's native migrations to **prisma-migrations**, adding rollback functionality while preserving your existing database and migration history.\n\n## What You'll Learn\n\nBy the end of this code lab, you'll know how to:\n- Integrate prisma-migrations into an existing Prisma project\n- Preserve your existing database schema and data\n- Add new migrations with rollback support\n- Handle data migrations with up/down functions\n- Leverage the new rollback capabilities\n\n## Prerequisites\n\n- Existing project using Prisma ORM\n- Existing database with Prisma migrations applied\n- Node.js 20+ or Bun installed\n- Basic knowledge of SQL and TypeScript\n\n## Scenario\n\nYou have a running application with:\n- PostgreSQL database\n- Prisma ORM with existing migrations\n- Tables: `users` and `posts`\n- Production data you can't lose\n- **No rollback capability** (Prisma's limitation)\n\nYou want to add rollback support without disrupting your existing setup.\n\n## Step 1: Assess Your Current State\n\nFirst, check your existing migrations:\n\n```bash\nls prisma/migrations\n```\n\nYou should see directories like:\n```\n20240101000000_init/\n20240102000000_add_posts/\n20240103000000_add_indexes/\n```\n\nCheck your database state:\n\n```bash\nnpx prisma migrate status\n```\n\nVerify all migrations are applied.\n\n## Step 2: Install prisma-migrations\n\nAdd prisma-migrations to your project:\n\n```bash\nnpm install -D prisma-migrations\n```\n\nYour `package.json` should now include:\n\n```json\n{\n  \"devDependencies\": {\n    \"prisma\": \"^6.0.0\",\n    \"prisma-migrations\": \"latest\"\n  }\n}\n```\n\n## Step 3: Use Existing Migrations Directory\n\n**Important**: prisma-migrations can work directly with your existing `prisma/migrations` directory. It supports both:\n- **SQL migrations** (`.sql` files) - Your existing Prisma migrations\n- **TypeScript migrations** (`.ts` files) - New migrations with rollback support\n\nNo need to create a separate directory unless you prefer to keep them separate.\n\n## Step 4: Configure prisma-migrations\n\nCreate `.prisma-migrationsrc.json`:\n\n```json\n{\n  \"migrationsDir\": \"./prisma/migrations\",\n  \"logLevel\": \"info\"\n}\n```\n\nThis tells prisma-migrations where to find migration files. Using `./prisma/migrations` allows you to work with existing Prisma migrations.\n\n## Step 5: Verify Compatibility\n\nRun a status check:\n\n```bash\nnpx prisma-migrations status\n```\n\nprisma-migrations reads from the same `_prisma_migrations` table that Prisma uses, so your existing migrations show as applied.\n\n## Step 6: Create Your First New Migration\n\nNow create a new migration with rollback support:\n\n```bash\nnpx prisma-migrations create add_comments_table\n```\n\nThis creates: `prisma/migrations/[timestamp]_add_comments_table/migration.ts`\n\n**Note**: Your existing migrations are `.sql` files. New migrations are `.ts` files with `up()` and `down()` functions for rollback support. prisma-migrations handles both types automatically.\n\nEdit the file:\n\n```typescript\nimport type { PrismaClient } from '@prisma/client';\n\n/**\n * Add comments table with rollback support\n */\nexport async function up(prisma: PrismaClient): Promise\u003Cvoid> {\n  await prisma.$executeRaw`\n    CREATE TABLE comments (\n      id SERIAL PRIMARY KEY,\n      content TEXT NOT NULL,\n      post_id INTEGER NOT NULL,\n      user_id INTEGER NOT NULL,\n      created_at TIMESTAMP DEFAULT NOW(),\n      updated_at TIMESTAMP DEFAULT NOW(),\n      FOREIGN KEY (post_id) REFERENCES posts(id) ON DELETE CASCADE,\n      FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE\n    )\n  `;\n\n  await prisma.$executeRaw`\n    CREATE INDEX idx_comments_post_id ON comments(post_id)\n  `;\n\n  await prisma.$executeRaw`\n    CREATE INDEX idx_comments_user_id ON comments(user_id)\n  `;\n}\n\n/**\n * Rollback comments table\n */\nexport async function down(prisma: PrismaClient): Promise\u003Cvoid> {\n  await prisma.$executeRaw`DROP TABLE IF EXISTS comments CASCADE`;\n}\n```\n\n## Step 7: Test the Migration\n\nRun the migration:\n\n```bash\nnpx prisma-migrations up\n```\n\nVerify the table was created:\n\n```bash\npsql -d your_db -c \"\\dt\"\n```\n\nYou should see `comments` table.\n\n## Step 8: Test Rollback (The New Feature!)\n\nNow try rolling back:\n\n```bash\nnpx prisma-migrations down\n```\n\nCheck the database again:\n\n```bash\npsql -d your_db -c \"\\dt\"\n```\n\nThe `comments` table is gone, but your existing `users` and `posts` tables are untouched.\n\n## Step 9: Re-apply the Migration\n\n```bash\nnpx prisma-migrations up\n```\n\nThe migration runs again, recreating the `comments` table.\n\n## Step 10: Add a Data Migration\n\nCreate a migration that modifies existing data:\n\n```bash\nnpx prisma-migrations create add_user_roles\n```\n\nEdit the migration:\n\n```typescript\nimport type { PrismaClient } from '@prisma/client';\n\n/**\n * Add role column to users and set default values\n */\nexport async function up(prisma: PrismaClient): Promise\u003Cvoid> {\n  // Add column\n  await prisma.$executeRaw`\n    ALTER TABLE users\n    ADD COLUMN role VARCHAR(50) DEFAULT 'user' NOT NULL\n  `;\n\n  // Update specific users (data migration)\n  await prisma.$executeRaw`\n    UPDATE users\n    SET role = 'admin'\n    WHERE email IN (\n      'admin@example.com',\n      'support@example.com'\n    )\n  `;\n\n  // Add index\n  await prisma.$executeRaw`\n    CREATE INDEX idx_users_role ON users(role)\n  `;\n}\n\n/**\n * Remove role column\n * Note: This drops the column, losing the data\n * Consider backing up critical data in production\n */\nexport async function down(prisma: PrismaClient): Promise\u003Cvoid> {\n  await prisma.$executeRaw`\n    ALTER TABLE users\n    DROP COLUMN role\n  `;\n}\n```\n\nRun it:\n\n```bash\nnpx prisma-migrations up\n```\n\nVerify:\n\n```bash\npsql -d your_db -c \"SELECT email, role FROM users LIMIT 5;\"\n```\n\n## Step 11: Update Your Prisma Schema\n\nUpdate `prisma/schema.prisma` to reflect the new columns:\n\n```prisma\nmodel User {\n  id        Int       @id @default(autoincrement())\n  email     String    @unique\n  name      String?\n  role      String    @default(\"user\") // NEW!\n  createdAt DateTime  @default(now()) @map(\"created_at\")\n  posts     Post[]\n  comments  Comment[] // NEW!\n\n  @@map(\"users\")\n}\n\nmodel Post {\n  id        Int       @id @default(autoincrement())\n  title     String\n  content   String?\n  userId    Int       @map(\"user_id\")\n  user      User      @relation(fields: [userId], references: [id])\n  createdAt DateTime  @default(now()) @map(\"created_at\")\n  comments  Comment[] // NEW!\n\n  @@map(\"posts\")\n}\n\n// NEW MODEL!\nmodel Comment {\n  id        Int      @id @default(autoincrement())\n  content   String\n  postId    Int      @map(\"post_id\")\n  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)\n  userId    Int      @map(\"user_id\")\n  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)\n  createdAt DateTime @default(now()) @map(\"created_at\")\n  updatedAt DateTime @default(now()) @map(\"updated_at\")\n\n  @@index([postId], name: \"idx_comments_post_id\")\n  @@index([userId], name: \"idx_comments_user_id\")\n  @@map(\"comments\")\n}\n```\n\nRegenerate Prisma Client:\n\n```bash\nnpx prisma generate\n```\n\n## Step 12: Use New Features in Your Code\n\nNow you can use the new tables:\n\n```typescript\nimport { PrismaClient } from '@prisma/client';\n\nconst prisma = new PrismaClient();\n\nasync function createComment() {\n  const comment = await prisma.comment.create({\n    data: {\n      content: 'Great post!',\n      postId: 1,\n      userId: 1,\n    },\n  });\n  console.log('Created comment:', comment);\n}\n\nasync function getUserWithComments() {\n  const user = await prisma.user.findFirst({\n    where: { role: 'admin' },\n    include: {\n      posts: {\n        include: {\n          comments: true,\n        },\n      },\n    },\n  });\n  console.log('User with comments:', user);\n}\n```\n\n## Step 13: Update Your Workflow\n\nUpdate your deployment scripts:\n\n```json\n{\n  \"scripts\": {\n    \"migrate:dev\": \"prisma-migrations up\",\n    \"migrate:status\": \"prisma-migrations status\",\n    \"migrate:create\": \"prisma-migrations create\",\n    \"migrate:rollback\": \"prisma-migrations down\",\n    \"migrate:fresh\": \"prisma-migrations fresh\",\n    \"postinstall\": \"prisma generate\"\n  }\n}\n```\n\n## Step 14: Handle Production Migrations\n\nFor production deployments:\n\n1. **Test in staging first**:\n   ```bash\n   npx prisma-migrations up\n   ```\n\n2. **Create a backup**:\n   ```bash\n   pg_dump your_db > backup_$(date +%Y%m%d).sql\n   ```\n\n3. **Run migrations**:\n   ```bash\n   npx prisma-migrations up\n   ```\n\n4. **If something goes wrong, rollback**:\n   ```bash\n   npx prisma-migrations down --steps 1\n   ```\n\n## Step 15: Best Practices\n\n### Safe Rollback Strategy\n\n```typescript\nexport async function down(prisma: PrismaClient): Promise\u003Cvoid> {\n  // For critical data, backup before dropping\n  await prisma.$executeRaw`\n    CREATE TABLE comments_backup AS\n    SELECT * FROM comments\n  `;\n\n  await prisma.$executeRaw`\n    DROP TABLE comments CASCADE\n  `;\n\n  // Note: Restore from backup if needed manually\n}\n```\n\n### Progressive Migration\n\nRecommended approach:\n\n1. Keep existing Prisma `.sql` migrations (they work as-is)\n2. Create new migrations as `.ts` files with rollback support\n3. Mix both types in the same directory\n4. Test rollback in development\n5. Build confidence gradually\n\n**Note**: SQL migrations execute via their `up()` function but show a warning on `down()` since they don't have rollback logic.\n\n### Version Control\n\nAdd to `.gitignore`:\n```\nnode_modules/\n.env\ndist/\n```\n\n**Do commit**:\n```\nmigrations/\n.prisma-migrationsrc.json\nprisma/schema.prisma\n```\n\n## Common Patterns\n\n### Adding a Column with Default\n\n```typescript\nexport async function up(prisma: PrismaClient): Promise\u003Cvoid> {\n  await prisma.$executeRaw`\n    ALTER TABLE users\n    ADD COLUMN status VARCHAR(20) DEFAULT 'active' NOT NULL\n  `;\n}\n\nexport async function down(prisma: PrismaClient): Promise\u003Cvoid> {\n  await prisma.$executeRaw`\n    ALTER TABLE users\n    DROP COLUMN status\n  `;\n}\n```\n\n### Renaming a Column\n\n```typescript\nexport async function up(prisma: PrismaClient): Promise\u003Cvoid> {\n  await prisma.$executeRaw`\n    ALTER TABLE users\n    RENAME COLUMN name TO full_name\n  `;\n}\n\nexport async function down(prisma: PrismaClient): Promise\u003Cvoid> {\n  await prisma.$executeRaw`\n    ALTER TABLE users\n    RENAME COLUMN full_name TO name\n  `;\n}\n```\n\n### Creating an Index\n\n```typescript\nexport async function up(prisma: PrismaClient): Promise\u003Cvoid> {\n  await prisma.$executeRaw`\n    CREATE INDEX CONCURRENTLY idx_users_email\n    ON users(email)\n  `;\n}\n\nexport async function down(prisma: PrismaClient): Promise\u003Cvoid> {\n  await prisma.$executeRaw`\n    DROP INDEX IF EXISTS idx_users_email\n  `;\n}\n```\n\n## Troubleshooting\n\n### \"Table already exists\"\n\nIf you see this error, the migration was partially applied:\n\n```bash\n# Check status\nnpx prisma-migrations status\n\n# If needed, manually mark as rolled back\nnpx prisma-migrations down\n```\n\n### \"Cannot rollback old Prisma migrations\"\n\nprisma-migrations can execute existing Prisma `.sql` migrations, but they don't have `down()` functions for rollback. Attempting to roll back a `.sql` migration will show a warning.\n\nSolution: Only rollback new `.ts` migrations that have `down()` functions. Leave old `.sql` migrations alone.\n\n### Merge Conflicts in Migrations\n\nIf multiple developers create migrations:\n\n1. Rename migrations to resolve timestamp conflicts\n2. Test migrations in order\n3. Update migration tracking if needed\n\n## Migration Checklist\n\nBefore deploying to production:\n\n- [ ] All migrations tested locally\n- [ ] Rollback tested for each migration\n- [ ] Database backup created\n- [ ] Prisma schema updated\n- [ ] Prisma client regenerated\n- [ ] Application code updated\n- [ ] Staging environment tested\n- [ ] Rollback plan documented\n\n## Summary\n\nYou've successfully migrated to prisma-migrations:\n\n- Existing database preserved\n- Existing Prisma `.sql` migrations work as-is\n- New `.ts` migrations have rollback support\n- Mix both migration types in the same directory\n- Data migrations with up/down functions\n- Safe deployment workflow established\n\nYou now have Prisma's ORM with rollback support.\n\n## Next Steps\n\n- [Create complex migrations](/docs/api-reference)\n- [Use the programmatic API](/docs/api-reference#programmatic-api)\n- [Set up CI/CD pipelines](/docs/workspaces)\n- [Explore workspace support](/docs/workspaces)\n\n## Related Documentation\n\n- [New Project Setup](/docs/codelab-new-project)\n- [API Reference](/docs/api-reference)\n- [Workspaces Guide](/docs/workspaces)","src/content/docs/codelab-migrate.mdx","8112c187427c3709","codelab-migrate.mdx","codelab-new-project",{"id":57,"data":59,"body":62,"filePath":63,"digest":64,"legacyId":65,"deferredRender":20},{"title":60,"description":61},"Code Lab: New Project Setup","Step-by-step guide to setting up a new project with PostgreSQL, Prisma ORM, and prisma-migrations","# Code Lab: Starting a New Project with Prisma Migrations\n\nThis code lab walks you through setting up a new project with PostgreSQL, Prisma ORM, and prisma-migrations from scratch. You'll learn how to create migrations, manage your database schema, and handle rollbacks.\n\n## What You'll Build\n\nBy the end of this code lab, you'll have:\n- A working Node.js project with PostgreSQL\n- Prisma ORM configured and connected\n- A migration system with rollback support\n- Two database tables (users and posts) with relationships\n- Understanding of the full migration workflow\n\n## Prerequisites\n\n- Node.js 20+ or Bun installed\n- PostgreSQL installed and running\n- Basic knowledge of SQL and TypeScript\n\n## Step 1: Initialize Your Project\n\nCreate a new directory and initialize a Node.js project:\n\n```bash\nmkdir my-new-project\ncd my-new-project\nnpm init -y\n```\n\nUpdate your `package.json` to use ES modules:\n\n```json\n{\n  \"name\": \"my-new-project\",\n  \"version\": \"1.0.0\",\n  \"type\": \"module\",\n  \"scripts\": {\n    \"migrate\": \"prisma-migrations\"\n  }\n}\n```\n\n## Step 2: Install Dependencies\n\nInstall Prisma and prisma-migrations:\n\n```bash\nnpm install @prisma/client\nnpm install -D prisma prisma-migrations\n```\n\n## Step 3: Setup Prisma\n\nCreate a Prisma schema file:\n\n```bash\nmkdir prisma\n```\n\nCreate `prisma/schema.prisma`:\n\n```prisma\n// Prisma Schema for New Project\n// Learn more: https://pris.ly/d/prisma-schema\n\ndatasource db {\n  provider = \"postgresql\"\n  url      = env(\"DATABASE_URL\")\n}\n\ngenerator client {\n  provider = \"prisma-client-js\"\n}\n\n// Models will be managed via prisma-migrations\n```\n\nCreate a `.env` file with your database connection:\n\n```bash\nDATABASE_URL=\"postgresql://user:password@localhost:5432/mydb\"\n```\n\nReplace `user`, `password`, and `mydb` with your actual PostgreSQL credentials.\n\n## Step 4: Initialize Prisma Migrations\n\nInitialize the migrations directory:\n\n```bash\nnpx prisma-migrations init\n```\n\nYou should see output like:\n\n```\n✓ Created migration: 1234567890_initial_migration\n  Location: ./migrations/1234567890_initial_migration\n```\n\nThis creates your first migration file at `migrations/[timestamp]_initial_migration/migration.ts`.\n\n## Step 5: Create Your First Migration - Users Table\n\nCreate a migration for the users table:\n\n```bash\nnpx prisma-migrations create create_users_table\n```\n\nThis creates a new migration directory. Open the `migration.ts` file and add:\n\n```typescript\nimport type { PrismaClient } from '@prisma/client';\n\n/**\n * Create users table\n */\nexport async function up(prisma: PrismaClient): Promise\u003Cvoid> {\n  await prisma.$executeRaw`\n    CREATE TABLE users (\n      id SERIAL PRIMARY KEY,\n      email VARCHAR(255) UNIQUE NOT NULL,\n      name VARCHAR(255),\n      created_at TIMESTAMP DEFAULT NOW(),\n      updated_at TIMESTAMP DEFAULT NOW()\n    )\n  `;\n}\n\n/**\n * Drop users table\n */\nexport async function down(prisma: PrismaClient): Promise\u003Cvoid> {\n  await prisma.$executeRaw`DROP TABLE IF EXISTS users CASCADE`;\n}\n```\n\n## Step 6: Create Second Migration - Posts Table\n\nCreate another migration for posts:\n\n```bash\nnpx prisma-migrations create create_posts_table\n```\n\nEdit the new `migration.ts` file:\n\n```typescript\nimport type { PrismaClient } from '@prisma/client';\n\n/**\n * Create posts table with foreign key to users\n */\nexport async function up(prisma: PrismaClient): Promise\u003Cvoid> {\n  await prisma.$executeRaw`\n    CREATE TABLE posts (\n      id SERIAL PRIMARY KEY,\n      title VARCHAR(255) NOT NULL,\n      content TEXT,\n      published BOOLEAN DEFAULT false,\n      author_id INTEGER NOT NULL,\n      created_at TIMESTAMP DEFAULT NOW(),\n      updated_at TIMESTAMP DEFAULT NOW(),\n      FOREIGN KEY (author_id) REFERENCES users(id) ON DELETE CASCADE\n    )\n  `;\n\n  await prisma.$executeRaw`\n    CREATE INDEX idx_posts_author_id ON posts(author_id)\n  `;\n}\n\n/**\n * Drop posts table\n */\nexport async function down(prisma: PrismaClient): Promise\u003Cvoid> {\n  await prisma.$executeRaw`DROP TABLE IF EXISTS posts CASCADE`;\n}\n```\n\n## Step 7: Check Migration Status\n\nBefore running migrations, check what's pending:\n\n```bash\nnpx prisma-migrations pending\n```\n\nYou should see all three migrations listed (initial, users, and posts).\n\nCheck the overall status:\n\n```bash\nnpx prisma-migrations status\n```\n\n## Step 8: Run Migrations\n\nApply all pending migrations:\n\n```bash\nnpx prisma-migrations up\n```\n\nYou should see output confirming the migrations were applied:\n\n```\n┌──────────┬──────────────────────────────────────────────────┐\n│ Status   │ Migrations                                       │\n├──────────┼──────────────────────────────────────────────────┤\n│ ✓        │ 3 migration(s) applied successfully              │\n└──────────┴──────────────────────────────────────────────────┘\n```\n\nVerify your database now has the tables:\n\n```bash\npsql -d mydb -c \"\\dt\"\n```\n\n## Step 9: Generate Prisma Client\n\nGenerate the Prisma Client to interact with your database:\n\n```bash\nnpx prisma generate\n```\n\n## Step 10: Test Your Setup\n\nCreate a test script `test.ts`:\n\n```typescript\nimport { PrismaClient } from '@prisma/client';\n\nconst prisma = new PrismaClient();\n\nasync function main() {\n  // Create a user\n  await prisma.$executeRaw`\n    INSERT INTO users (email, name)\n    VALUES ('alice@example.com', 'Alice')\n  `;\n\n  // Get users\n  const users = await prisma.$queryRaw`\n    SELECT * FROM users\n  `;\n  console.log('Users:', users);\n\n  // Create a post\n  const [user] = await prisma.$queryRaw\u003CArray\u003C{ id: number }>>`\n    SELECT id FROM users WHERE email = 'alice@example.com'\n  `;\n\n  await prisma.$executeRaw`\n    INSERT INTO posts (title, content, author_id)\n    VALUES ('My First Post', 'Hello World!', ${user.id})\n  `;\n\n  // Get posts with user info\n  const posts = await prisma.$queryRaw`\n    SELECT p.*, u.name as author_name\n    FROM posts p\n    JOIN users u ON p.author_id = u.id\n  `;\n  console.log('Posts:', posts);\n}\n\nmain()\n  .catch(console.error)\n  .finally(() => prisma.$disconnect());\n```\n\nRun it:\n\n```bash\nnpx tsx test.ts\n```\n\n## Step 11: Test Rollback\n\nRollback the last migration:\n\n```bash\nnpx prisma-migrations down\n```\n\nThis removes the posts table. Verify:\n\n```bash\nnpx prisma-migrations status\n```\n\nRe-apply the migration:\n\n```bash\nnpx prisma-migrations up\n```\n\n## Step 12: Advanced Operations\n\n### Rollback Multiple Migrations\n\n```bash\nnpx prisma-migrations down --steps 2\n```\n\n### Fresh Start (Rollback All + Re-run)\n\n```bash\nnpx prisma-migrations fresh\n```\n\n### Reset All Migrations\n\n```bash\nnpx prisma-migrations reset\n```\n\n### Interactive Mode\n\n```bash\nnpx prisma-migrations up --interactive\nnpx prisma-migrations down --interactive\n```\n\n## Next Steps\n\nNow that you have a working setup:\n\n1. **Add more migrations** as your schema evolves\n2. **Use the programmatic API** in your application code\n3. **Set up CI/CD** to run migrations automatically\n4. **Explore seeding** data in migrations\n5. **Add validation** and constraints to your tables\n\n## Common Patterns\n\n### Data Seeding in Migrations\n\n```typescript\nexport async function up(prisma: PrismaClient): Promise\u003Cvoid> {\n  // Create table\n  await prisma.$executeRaw`\n    CREATE TABLE roles (\n      id SERIAL PRIMARY KEY,\n      name VARCHAR(50) UNIQUE NOT NULL\n    )\n  `;\n\n  // Seed initial data\n  await prisma.$executeRaw`\n    INSERT INTO roles (name) VALUES\n    ('admin'),\n    ('user'),\n    ('moderator')\n  `;\n}\n```\n\n### Adding Columns to Existing Tables\n\n```typescript\nexport async function up(prisma: PrismaClient): Promise\u003Cvoid> {\n  await prisma.$executeRaw`\n    ALTER TABLE users\n    ADD COLUMN avatar_url VARCHAR(500),\n    ADD COLUMN bio TEXT\n  `;\n}\n\nexport async function down(prisma: PrismaClient): Promise\u003Cvoid> {\n  await prisma.$executeRaw`\n    ALTER TABLE users\n    DROP COLUMN avatar_url,\n    DROP COLUMN bio\n  `;\n}\n```\n\n### Creating Indexes\n\n```typescript\nexport async function up(prisma: PrismaClient): Promise\u003Cvoid> {\n  await prisma.$executeRaw`\n    CREATE INDEX idx_users_email ON users(email)\n  `;\n}\n\nexport async function down(prisma: PrismaClient): Promise\u003Cvoid> {\n  await prisma.$executeRaw`\n    DROP INDEX IF EXISTS idx_users_email\n  `;\n}\n```\n\n## Troubleshooting\n\n### Migration Fails Midway\n\nIf a migration fails, check:\n1. Database connection is working\n2. SQL syntax is correct\n3. No conflicting constraints\n4. Previous migrations ran successfully\n\n### Rollback Doesn't Work\n\nEnsure your `down()` function properly reverses the `up()` function:\n- Drop tables created in `up()`\n- Remove columns added in `up()`\n- Delete data inserted in `up()`\n\n### Can't Find Migrations\n\nCheck your configuration in `.prisma-migrationsrc.json`:\n\n```json\n{\n  \"migrationsDir\": \"./migrations\"\n}\n```\n\n## Summary\n\nYou've successfully:\n- Set up a new project with Prisma and prisma-migrations\n- Created multiple migrations with relationships\n- Learned the full migration workflow (create, run, rollback)\n- Tested your database with real data\n- Explored advanced operations\n\nYou now have a foundation for managing database migrations in your projects.\n\n## Related Documentation\n\n- [API Reference](/docs/api-reference)\n- [Migrating from Existing Prisma](/docs/codelab-migrate)\n- [Workspaces Guide](/docs/workspaces)","src/content/docs/codelab-new-project.mdx","fea4a6129c89a4b4","codelab-new-project.mdx"]